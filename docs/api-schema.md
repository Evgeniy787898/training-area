# API Training Area ‚Äî –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp –∏ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫ `https://<your-host>/v1/*` –∏ —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Telegram-Id` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `telegram_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ `X-Profile-Id` —Å UUID –ø—Ä–æ—Ñ–∏–ª—è).

## –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- `Content-Type: application/json`
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <jwt>` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) + –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`X-Telegram-Id` –∏–ª–∏ `X-Profile-Id`).
- –í –æ—Ç–≤–µ—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `x-trace-id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –≤ Supabase.
- –û—à–∏–±–∫–∏ –∏–º–µ—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```json
{
  "error": "validation_failed",
  "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
  "issues": [ ... ],
  "trace_id": "..."
}
```

## Endpoints

### `GET /v1/profile/summary`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏.

**Response 200**

```json
{
  "profile": {
    "id": "uuid",
    "notification_time": "06:30:00",
    "timezone": "Europe/Moscow",
    "preferences": {"training_frequency": 4},
    "notifications_paused": false
  },
  "adherence": {
    "window": "30d",
    "total_sessions": 12,
    "completed_sessions": 9,
    "adherence_percent": 75
  },
  "metrics": [
    {
      "id": "uuid",
      "metric_type": "training_completed",
      "value": 1,
      "recorded_at": "2024-03-30T18:01:00+00:00"
    }
  ]
}
```

### `PATCH /v1/profile/preferences`

–û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å. –í—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.

**Request**

```json
{
  "notification_time": "07:30",
  "timezone": "Europe/Moscow",
  "notifications_paused": false
}
```

**Responses**

- `200 OK` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.
- `400 invalid_payload` ‚Äî —Ç–µ–ª–æ –ø—É—Å—Ç–æ–µ.
- `409 conflict_with_existing_pause` ‚Äî –¥–∞—Ç–∞ –ø–∞—É–∑—ã —É–∂–µ –∏—Å—Ç–µ–∫–ª–∞.

### `GET /v1/sessions/today`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω —Ç–µ–∫—É—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ï—Å–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**Response 200**

```json
{
  "session": {
    "id": "uuid",
    "date": "2024-03-31",
    "session_type": "–í–µ—Ä—Ö —Ç–µ–ª–∞",
    "exercises": [
      {
        "exercise_key": "pullups",
        "name": "–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è",
        "target": {"sets": 4, "reps": 6},
        "notes": "–õ–æ–∫—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω–∏–∑"
      }
    ],
    "status": "planned",
    "rpe": 7
  },
  "source": "database"
}
```

### `GET /v1/sessions/week?date=2024-03-31`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫‚Äì–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.

### `GET /v1/sessions/{id}`

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ. –û—à–∏–±–∫–∏: `404 session_not_found`, `403 forbidden`.

### `PUT /v1/sessions/{id}`

–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏. –ü–æ–ª—è `status`, `rpe`, `notes` –∏ `exercises` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.

**Request**

```json
{
  "status": "done",
  "completed_at": "2024-03-31T18:34:00+03:00",
  "rpe": 7.5,
  "exercises": [
    {
      "exercise_key": "pullups",
      "actual": {"sets": 4, "reps": 7},
      "notes": "–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–¥—Ö–æ–¥ –¥–∞–ª—Å—è —Ç—è–∂–µ–ª–æ"
    }
  ]
}
```

**Response 200**

```json
{
  "success": true,
  "session": { ...updated session... },
  "decision": "advance|hold|regress|adjust_focus",
  "next_steps": "–¢–µ–∫—Å—Ç–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"
}
```

–û—à–∏–±–∫–∏: `422 validation_failed`, `404 session_not_found`, `403 forbidden`.

### `GET /v1/reports/volume_trend?range=30d`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É –æ–±—ä—ë–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ. –î–∏–∞–ø–∞–∑–æ–Ω ‚Äî `7d`, `30d`, `12w` –∏ —Ç.–ø.

**Response 200**

```json
{
  "report": "volume_trend",
  "range": "30d",
  "chart": [
    {"date": "2024-03-20", "volume": 180, "status": "done"}
  ],
  "summary": {
    "total_volume": 1240,
    "average_volume": 177,
    "period_sessions": 7
  },
  "generated_at": "2024-03-31T18:05:00.000Z"
}
```

### `GET /v1/reports/rpe_distribution?range=30d`

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ –∫—Ä–∞—Ç–∫–æ–µ summary.

### `GET /v1/achievements`

–°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ 10 –∑–∞–ø–∏—Å–µ–π).

**Response 200**

```json
{
  "achievements": [
    {
      "id": "uuid",
      "title": "–ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è",
      "description": "–í—ã–ø–æ–ª–Ω–µ–Ω–æ 3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–¥—Ä—è–¥",
      "awarded_at": "2024-03-28T10:00:00+00:00"
    }
  ]
}
```

### `GET /v1/exercises/catalog`

–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–º–µ—Ç–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ).

**Response 200**

```json
{
  "items": [
    {
      "key": "pullups",
      "title": "–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è",
      "focus": "–°–ø–∏–Ω–∞ –∏ —Ö–≤–∞—Ç",
      "description": "10-—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è –æ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Ç—è–≥–∏ –¥–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π –Ω–∞ –æ–¥–Ω–æ–π —Ä—É–∫–µ.",
      "cue": "–õ–æ–∫—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω–∏–∑, –∫–æ—Ä–ø—É—Å –∂—ë—Å—Ç–∫–∏–π.",
      "levels": [
        { "id": "1.1", "title": "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è", "sets": 1, "reps": 10 },
        { "id": "1.2", "title": "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è", "sets": 2, "reps": 20 }
      ],
      "latest_progress": {
        "level": "3.2",
        "decision": "advance",
        "session_date": "2024-03-28",
        "updated_at": "2024-03-28T19:32:04.125Z"
      }
    }
  ],
  "generated_at": "2024-03-31T20:00:00.000Z"
}
```

### `GET /v1/exercises/{exerciseKey}/history`

–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–¥–æ 20 –∑–∞–ø–∏—Å–µ–π).

**Response 200**

```json
{
  "exercise": "pullups",
  "items": [
    {
      "session_date": "2024-03-28",
      "level_target": "3.2",
      "level_result": "3.3",
      "volume_target": 30,
      "volume_actual": 36,
      "rpe": 7,
      "decision": "advance",
      "notes": "–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ",
      "recorded_at": "2024-03-28T19:32:04.125Z"
    }
  ]
}
```

### `POST /v1/assistant/reply`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –¥–≤–∏–∂–∫–∞ –±–µ–∑ —É—á–∞—Å—Ç–∏—è Telegram.

```json
{
  "message": "–°–æ—Ö—Ä–∞–Ω–∏: —Å–¥–µ–ª–∞—Ç—å –∑–∞–º–∏–Ω–∫—É –ø–µ—Ä–µ–¥ —Å–Ω–æ–º",
  "mode": "chat",
  "persist": true
}
```

**Response 200**

```json
{
  "reply": "üóíÔ∏è –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª: ¬´—Å–¥–µ–ª–∞—Ç—å –∑–∞–º–∏–Ω–∫—É –ø–µ—Ä–µ–¥ —Å–Ω–æ–º¬ª. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å ‚Äî –Ω–∞–ø–∏—à–∏ –≤—Ä–µ–º—è.",
  "intent": "note_save",
  "confidence": 0.86,
  "candidates": [
    {"intent": "note_save", "confidence": 0.86},
    {"intent": "help", "confidence": 0.30}
  ],
  "saved": true
}
```

–û—à–∏–±–∫–∏: `422 validation_failed` (–ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ).

### `GET /v1/assistant/notes?limit=20`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```json
{
  "notes": [
    {
      "id": "uuid",
      "title": "–ü–µ—Ä–µ–¥ –ø–æ–µ–∑–¥–∫–æ–π",
      "content": "–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞",
      "tags": ["–∫–æ–Ω—Ç—Ä–æ–ª—å"],
      "source": "chat",
      "created_at": "2024-04-18T12:40:00+00:00"
    }
  ]
}
```

### `POST /v1/assistant/notes`

–°–æ–∑–¥–∞—ë—Ç –∑–∞–º–µ—Ç–∫—É –≤ –∂—É—Ä–Ω–∞–ª–µ.

```json
{
  "content": "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ç—è–∂–∫—É –≤ —Å—Ä–µ–¥—É",
  "title": "–°—Ä–µ–¥–∞",
  "tags": ["—Ä–∞–∑–º–∏–Ω–∫–∞", "–∏–¥–µ—è"]
}
```

**Response 201**

```json
{
  "note": {
    "id": "uuid",
    "content": "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ç—è–∂–∫—É –≤ —Å—Ä–µ–¥—É",
    "tags": ["—Ä–∞–∑–º–∏–Ω–∫–∞", "–∏–¥–µ—è"],
    "source": "api",
    "created_at": "2024-04-18T13:15:00+00:00"
  }
}
```

–û—à–∏–±–∫–∏: `422 validation_failed` (–µ—Å–ª–∏ `content` –ø—É—Å—Ç).

---

–í—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É `observability_events` (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `plan_viewed`, `session_marked_done`, `preferences_updated`, `report_requested`, `achievements_viewed`). –û—à–∏–±–∫–∏ —Å–ª–µ–¥—É–µ—Ç –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ `trace_id`.
