# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–≤–∏–∂–æ–∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã —Ç—Ä–µ–Ω–µ—Ä–∞, –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö AI-—Å–µ—Ä–≤–∏—Å–æ–≤. –ü—Ä–∞–≤–∏–ª–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —É—Ç–æ—á–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [¬´–ü—Ä–∞–≤–∏–ª–∞ –ò–ò –∏ –¥–∏–∞–ª–æ–≥–∞¬ª](pravila-ii-i-dialoga.md).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
server/services/internalAssistantEngine.js
 ‚îú‚îÄ interpretCommand()        // –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ –∏ —Å–ª–æ—Ç–æ–≤
 ‚îú‚îÄ generateTrainerReply()    // —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Ç—Ä–µ–Ω–µ—Ä–∞
 ‚îú‚îÄ generateGeneralReply()    // —Å–≤–æ–±–æ–¥–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –±–ª–æ–∫–∏
 ‚îú‚îÄ generateTrainingPlan()    // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
 ‚îú‚îÄ analyzeTrainingReport()   // –∞–Ω–∞–ª–∏–∑ –æ—Ç—á—ë—Ç–æ–≤ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
 ‚îî‚îÄ buildMotivationMessage()  // –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ streak'–∏
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:

- `services/conversation.js` ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∏–∂–æ–∫ —Å –ª–æ–≥–∏–∫–æ–π fallback (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω, –ø–æ–¥—Å–∫–∞–∑–∫–∏ WebApp).
- `services/localResponder.js` ‚Äî –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏, –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É.
- `services/planner.js` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –±–æ—Ç–∞ –∏ WebApp.
- `supabase/functions/update_plan` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω –Ω–µ–¥–µ–ª–∏ —Ç–µ–º–∏ –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏, —á—Ç–æ –∏ –¥–≤–∏–∂–æ–∫, –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ—Ä—Å–∏—é –≤ –ë–î.

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

1. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: —Ü–µ–ª–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —á–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, —Ñ–ª–∞–≥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
2. **Adherence/metrics**: –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, streak, –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (`metrics` —Ç–∞–±–ª–∏—Ü–∞).
3. **–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤**: –¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
4. **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** (–¥–ª—è update_plan): –¥–∞—Ç–∞, —Å—Ç–∞—Ç—É—Å, RPE, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–µ—Å—Å–∏–π.

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

`interpretCommand()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–≤–∞—Ä–∏ –∏–∑ `services/nlu.js`:

- `intent` –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (`plan_today`, `report_start`, `remind_later`, ...).
- `candidate_intents` —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º, –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–∏–∂–µ 0.6.
- `slots` –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (`reminder`), –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (`preferred_shift_days`, `preferred_day`).
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–≤–∏–∂–æ–∫ –∑–∞–¥–∞—ë—Ç —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `needs_clarification = true`.
- –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —è–≤–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã —É—Å–ø–µ—Ö–∞/–ø—Ä–æ–ø—É—Å–∫–∞ (`SUCCESS_REGEX`, `MISS_REGEX`).

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ —Ç—Ä–µ–Ω–µ—Ä–∞

–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –∫–∞–∫ –±–ª–æ–∫–∏:

```
<—Ä–µ–∑—é–º–µ>
**–¶–µ–ª—å:** ...
**–†–∞–∑–º–∏–Ω–∫–∞:** ...
**–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å:** ...
**–ó–∞–º–∏–Ω–∫–∞:** ...
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** ...
```

- –î–ª—è `plan_today` –∏ `plan_week` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —à–∞–±–ª–æ–Ω—ã –∏–∑ `staticPlan.js` —Å —É—á—ë—Ç–æ–º —á–∞—Å—Ç–æ—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.
- `report_start` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±—ä—ë–º, RPE –∏ –∑–∞–º–µ—Ç–∫–∏, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (`‚úÖ`) –∏–ª–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ (`‚ö†Ô∏è`).
- `motivation` –∏ `help` –ø–æ–¥–∫–ª—é—á–∞—é—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏ —Å–ø—Ä–∞–≤–∫—É –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.
- `open_webapp` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—å WebApp.

## –î–∏–∞–ª–æ–≥ –≤ —á–∞—Ç-—Ä–µ–∂–∏–º–µ

`generateGeneralReply()` —Ä–µ—à–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Ç—Ä–µ–Ω–µ—Ä—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç:

- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—Ö–∞/–ø—Ä–æ–ø—É—Å–∫–∞/—É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ –≤—ã–±–∏—Ä–∞—é—Ç –æ–¥–Ω—É –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π (`success`, `slump`, `fatigue`, `neutral`).
- –í–æ–ø—Ä–æ—Å—ã –æ –∫–∞–ª–∏—Å—Ç–µ–Ω–∏–∫–µ, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–∏–Ω–≥–µ, RPE, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ (`TOPIC_SNIPPETS`).
- –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—Å—Ç–∞–ª–æ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.
- –ù–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–¥–∞—é—Ç—Å—è `localResponder.genericReply`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø—Ä–æ —Ü–µ–ª–∏ –∏ –ø—Ä–æ—Å–∏—Ç —É—Ç–æ—á–Ω–∏—Ç—å –∑–∞–¥–∞—á—É.

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤

`generateTrainingPlan()`

1. –°–æ–±–∏—Ä–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –ø–æ —Ü–µ–ª—è–º, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º.
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `buildDefaultWeekPlan()` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è 4‚Äì6 —Å–µ—Å—Å–∏–π (–≤–µ—Ä—Ö/–Ω–∏–∑, –º–µ—Ç–∫–æ–Ω, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ).
3. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏, —Ü–µ–ª–µ–≤–æ–≥–æ RPE –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `rawText` –∏ –æ–±—ä–µ–∫—Ç `structured` (–ø–ª–∞–Ω + summary) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

### Edge Function `update_plan`

- –†–∞–±–æ—Ç–∞–µ—Ç –≤ Supabase –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API.
- –ë–µ—Ä—ë—Ç –ø—Ä–æ—Ñ–∏–ª—å, –∏—Å—Ç–æ—Ä–∏—é –∏ –ø—Ä–∏—á–∏–Ω—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω —á–µ—Ä–µ–∑ `buildFallbackPlan()` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:
  - `notes` –∏ `intensity` –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω recovery-mode –∏–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç `recovery`/`injury`.
  - `summary.recent_sessions` ‚Äî –∫—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.
  - `metadata.adjustments` ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∏, –ø–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω —Ç–∞–∫–æ–π —Ä–µ–∂–∏–º.
- –ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `plan_versions`, –ª–æ–≥ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `plan_generation_log`.

## –ê–Ω–∞–ª–∏–∑ –æ—Ç—á—ë—Ç–æ–≤

`analyzeTrainingReport()`:

1. –°—á–∏—Ç–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `completion` (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä—ë–º vs —Ü–µ–ª–µ–≤–æ–π).
2. –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –æ—Ü–µ–Ω–∫–æ–π (`‚úÖ/üîÅ/‚ö†Ô∏è`), —Å–æ–≤–µ—Ç–æ–º –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ, –∑–∞–º–∏–Ω–∫–µ –∏ ¬´—Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É¬ª.
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `suggestions`: `advance`, `hold`, `regress`, –∞ —Ç–∞–∫–∂–µ `recovery`, –µ—Å–ª–∏ –≤ –∑–∞–º–µ—Ç–∫–∞—Ö –µ—Å—Ç—å –º–∞—Ä–∫–µ—Ä—ã —É—Å—Ç–∞–ª–æ—Å—Ç–∏.

## –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

`buildMotivationMessage()` –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç:

- `adherence_percent` ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –ø–æ—Ö–≤–∞–ª—ã.
- `streak` ‚Äî —Å–µ—Ä–∏—è –ø–æ–¥—Ä—è–¥ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –µ—ë –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.
- `progressData` (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞) ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å.
- –§–∏–Ω–∞–ª—å–Ω—ã–π call-to-action: –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–ª–∞–Ω –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç—å —Å–±–æ—Ä–∫—É –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–≤–∏–∂–∫–∞

1. **–ù–æ–≤—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã:** –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ `services/nlu.js`, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç—å `buildStructuredReply()` –∏ `localResponder`.
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:** —Ä–∞—Å—à–∏—Ä–∏—Ç—å `buildPlanTodayBlocks`/`buildPlanWeekBlocks` –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –ø–µ—Ä–µ–¥–∞—Ç—å –≤ `generateTrainingPlan()` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (HRV, —Å–æ–Ω) –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏—Ö –≤ `buildAdjustmentHints`.
4. **–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –æ–±–Ω–æ–≤–∏—Ç—å `determineGreetingTone` –∏–ª–∏ `buildMotivationMessage` –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Ä–∞—Ñ–æ–Ω, –æ—Ç–ø—É—Å–∫).

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞

- –í—Å–µ –≤—ã–∑–æ–≤—ã update_plan –ø–æ–ª—É—á–∞—é—Ç `traceId` –∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç –µ–≥–æ –≤ `plan.summary.trace_id` –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `observability_events` (–∫–∞—Ç–µ–≥–æ—Ä–∏—è `preferences_updated`).
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `dialog_state` —Å TTL 48 —á–∞—Å–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–≤–∏–∂–∫—É —É—á–∏—Ç—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.

