# Telegram WebApp — UI/UX-спецификация

## Цели и охват
WebApp дополняет чат-бота визуальными экранами для просмотра плана, прогресса и аналитики. Приложение запускается из инлайн-кнопок или через меню бота и должно работать в мобильном Telegram-клиенте.

## Навигация и информация архитектуры
- Нижняя навигационная панель с пятью вкладками: «Сегодня», «План недели», «Отчёт», «Прогресс», «Настройки».
- Глобальная кнопка возврата в чат и статус-секция с активным `trace_id` запроса.
- Состояния загрузки: skeleton-компоненты для списков, спиннер для графиков.
- Ошибки отображаются в toast-уведомлениях с возможностью повторить запрос.

## Экран «Сегодня»
- Заголовок с датой и уровнем нагрузки на день.
- Карточки упражнений: название, подходы/повторы, RPE, таймеры отдыха.
- CTA-кнопки: «Отметить выполнено», «Отложить», «Открыть замену».
- Состояние пустого дня: сообщение о дне отдыха и переход к «Прогресс».

## Экран «План недели»
- Календари с полосой прогресса по дням.
- Возможность пролистывать недели свайпами.
- Каждая карточка дня содержит краткое описание и индикатор, была ли тренировка выполнена.
- Контекстное меню для отката версии (переход к чату с командой `PLAN_REVERT`).

## Экран «Отчёт»
- Форма с выбором тренировки/дня, шкалой RPE (1–10), полем заметок.
- Предустановленные шаблоны ответов («Слишком тяжело», «Нужно увеличить вес»).
- Кнопка отправки формирует событие `report_submitted` с данными и закрывает WebApp.

## Экран «Прогресс»
- Графики объёма, RPE и уровней сложностей (данные приходят из кэшированного каталога отчётов).
- Возможность переключать диапазоны (7 дней, 30 дней, кастомный).
- Кнопка «Открыть в чате» создаёт deep-link для запроса той же аналитики.

## Экран «Настройки»
- Единственный контрол «Время уведомлений»: time picker, переключатель часового пояса.
- Информация о правилах выходных и паузах уведомлений.
- Кнопка «Сохранить» подтверждает изменения и показывает toast «Время уведомлений обновлено».

## Дизайн-стандарты
- Цветовая схема: основной цвет — #2B6CB0, акцент — #68D391, фон — #F7FAFC.
- Шрифты: Inter 16px для текста, 20px для заголовков.
- Кнопки имеют радиус скругления 12px, тени уровня 1.
- Поддержка тёмной темы Telegram: цвета инвертируются согласно гайдлайнам.
- Все интерактивные элементы доступны по табу и имеют фокус-стили.

## Доступность
- Контраст текста ≥ 4.5:1.
- Контент читаем без масштабирования до 200%.
- Для графиков есть текстовые описания («Прогресс по объёму: +12% за 30 дней»).

## Протокол WebApp ↔ бот
- **Инициализация**: бот отправляет payload с `user_id`, `trace_id`, `auth_token` (подписанный JWT) и локалью.
- **События из WebApp**: `open_report`, `report_submitted`, `settings_updated`, `analytics_opened`.
- **Ответы бота**: ack с кодом статуса, обновлённые данные, уведомления о конфликте версий.
- **Кэширование**: WebApp хранит данные в sessionStorage не более 15 минут.
- **Безопасность**: каждая отправка подписывается HMAC с использованием секретного ключа бота.

## Сценарии отказов
- Нет сети: WebApp показывает офлайн-экран и предлагает вернуться к чату.
- Истёк токен: запрос обновления токена через метод `expand.getAuthData` Telegram.
- Сбой API: fallback на отправку текстового отчёта через чат.
