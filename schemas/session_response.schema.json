{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CoachingSessionResponse",
  "type": "object",
  "required": [
    "athlete_id",
    "session_date",
    "warm_up",
    "main_sets",
    "cooldown",
    "recovery_tips",
    "adjustment_notes",
    "validation_report"
  ],
  "properties": {
    "athlete_id": {
      "type": "string",
      "minLength": 1
    },
    "session_date": {
      "type": "string",
      "format": "date"
    },
    "contextual_flags": {
      "type": "object",
      "additionalProperties": {
        "type": ["string", "number", "boolean"]
      }
    },
    "warm_up": {
      "type": "object",
      "required": ["general", "movement_prep"],
      "properties": {
        "general": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["description", "duration_minutes"],
            "properties": {
              "description": {"type": "string"},
              "duration_minutes": {"type": "number", "minimum": 1}
            }
          },
          "minItems": 1
        },
        "movement_prep": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["exercise", "sets", "reps"],
            "properties": {
              "exercise": {"type": "string"},
              "sets": {"type": "integer", "minimum": 1},
              "reps": {"type": "integer", "minimum": 1},
              "cues": {"type": "string"}
            }
          },
          "minItems": 1
        }
      }
    },
    "main_sets": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["exercise", "sets", "reps", "intensity"],
        "properties": {
          "exercise": {"type": "string"},
          "pattern": {"type": "string"},
          "sets": {"type": "integer", "minimum": 1},
          "reps": {"type": "integer", "minimum": 1},
          "intensity": {
            "type": "object",
            "required": ["metric", "target"],
            "properties": {
              "metric": {"type": "string", "enum": ["RPE", "%1RM", "load_kg", "load_lb"]},
              "target": {"type": "number"},
              "range": {
                "type": "array",
                "items": {"type": "number"},
                "minItems": 2,
                "maxItems": 2
              }
            }
          },
          "rest_seconds": {"type": "integer", "minimum": 30},
          "tempo": {"type": "string"},
          "cues": {"type": "string"},
          "progression_note": {"type": "string"}
        }
      },
      "minItems": 1
    },
    "cooldown": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["activity", "duration_minutes"],
        "properties": {
          "activity": {"type": "string"},
          "duration_minutes": {"type": "number", "minimum": 2},
          "focus": {"type": "string"}
        }
      },
      "minItems": 1
    },
    "recovery_tips": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["category", "recommendation"],
        "properties": {
          "category": {"type": "string", "enum": ["sleep", "nutrition", "hydration", "mobility", "stress"]},
          "recommendation": {"type": "string"},
          "rationale": {"type": "string"}
        }
      },
      "minItems": 1
    },
    "adjustment_notes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["topic", "detail"],
        "properties": {
          "topic": {"type": "string"},
          "detail": {"type": "string"}
        }
      }
    },
    "validation_report": {
      "$ref": "validation_report.schema.json"
    }
  },
  "additionalProperties": false
}
